<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemeinsame Zeichenfläche</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background: white;
            border: 2px solid #000;
            margin: 10px auto;
            width: 95vw;
            max-width: 800px;
            height: 60vh;
            position: relative;
        }
        canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
            touch-action: none;
        }
        .toolbar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        input, button, select {
            font-size: 1rem;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Gemeinsame Zeichenfläche</h1>
    <div class="toolbar">
        <input type="color" id="colorPicker" value="#000000">
        <select id="tool">
            <option value="brush">Pinsel</option>
            <option value="eraser">Radierer</option>
            <option value="text">Text</option>
            <option value="emoji">Emoji</option>
        </select>
        <input type="text" id="textInput" placeholder="Text oder Emoji eingeben..." style="display: none;">
        <input type="range" id="brushSize" min="2" max="20" value="5">
        <button id="clearCanvas">Seite löschen</button>
    </div>
    <div class="canvas-container">
        <canvas id="drawingCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const colorPicker = document.getElementById('colorPicker');
        const toolSelector = document.getElementById('tool');
        const textInput = document.getElementById('textInput');
        const brushSize = document.getElementById('brushSize');
        const clearButton = document.getElementById('clearCanvas');

        // Canvas Größe anpassen
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        let isDrawing = false;
        let lastX, lastY;
        let brushColor = "#000000";
        let brushWidth = 5;
        let currentTool = "brush";

        // Mausereignisse für Zeichnen
        function startDrawing(e) {
            if (currentTool === 'brush' || currentTool === 'eraser') {
                isDrawing = true;
                [lastX, lastY] = getMousePosition(e);
            }
        }

        function draw(e) {
            if (!isDrawing || currentTool === 'text' || currentTool === 'emoji') return;

            const { x, y } = getMousePosition(e);

            ctx.beginPath();
            ctx.lineWidth = brushWidth;
            ctx.lineCap = 'round';
            ctx.strokeStyle = currentTool === 'eraser' ? '#FFFFFF' : brushColor;
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();

            [lastX, lastY] = [x, y];
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function getMousePosition(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }

        // Touch-Ereignisse für mobile Geräte
        canvas.addEventListener('touchstart', (e) => startDrawing(e.touches[0]));
        canvas.addEventListener('touchmove', (e) => draw({ clientX: e.touches[0].clientX, clientY: e.touches[0].clientY }));
        canvas.addEventListener('touchend', stopDrawing);

        // Mausereignisse
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);

        // Farbauswahl
        colorPicker.addEventListener('input', (e) => {
            brushColor = e.target.value;
        });

        // Pinselgröße
        brushSize.addEventListener('input', (e) => {
            brushWidth = e.target.value;
        });

        // Werkzeugauswahl
        toolSelector.addEventListener('change', (e) => {
            currentTool = e.target.value;
            if (currentTool === 'text' || currentTool === 'emoji') {
                textInput.style.display = 'inline-block';
                textInput.focus();
            } else {
                textInput.style.display = 'none';
            }
        });

        // Text oder Emoji hinzufügen
        canvas.addEventListener('click', (e) => {
            if (currentTool !== 'text' && currentTool !== 'emoji') return;

            const text = textInput.value.trim();
            if (!text) return;

            const { x, y } = getMousePosition(e);
            ctx.font = `${brushWidth * 4}px Arial`;
            ctx.fillStyle = brushColor;
            ctx.fillText(text, x, y);

            textInput.value = '';
        });

        // Canvas leeren
        clearButton.addEventListener('click', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
    </script>
</body>
</html>
